<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Basic style for the error message */
        .error-message {
            color: red;
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="welcome-section">
            <h1>Welcome to OROVE</h1>
            <p>Experience the future of learning with our AI-driven virtual classroom! Our smart AI teaches concepts interactively just like a real teacher on a board. ðŸ“–ðŸŽ“</p>
        </div>
        <div class="login-section">
            <h2>USER LOGIN</h2>
            <form action="/login" method="POST">  <!-- Added action and method -->
                <div class="input-container">
                    <i class="fa fa-envelope"></i>
                    <input type="email" placeholder="email" class="input-field" name="email" required>
                </div>
                <div class="input-container">
                    <i class="fa fa-lock"></i>
                    <input type="password" placeholder="Password" class="input-field" name="password" required>
                </div>
                <div class="remember-forgot">
                    <label><input type="checkbox"> Remember</label>
                    <a href="#">Forgot password?</a>
                    <a href="/signup">signup?</a>
                </div>
                <button type="submit" class="login-btn">LOGIN</button>
                <% if (errorMessage) { %>
                    <div class="error-message">
                        <p><%= errorMessage %></p>
                    </div>
                <% } %>
            </form>
            
        </div>
    </div>
    <script>
        const loginUser = async (email, password) => {
            try {
                const response = await axios.post('/login', { email, password }, { withCredentials: true })
                .then(response => {
                    console.log("Login Response:", response.data.message);
                    
                    // Redirect the user to /home
                    window.location.href = "/home";
                })
                .catch(error => {
                    console.error("Login Error:", error.response?.data?.message || "Something went wrong");
                    alert("Login failed! Check your credentials.");
                });
            
                
        
                if (response.data.message === "Login successful") {
                    console.log("User logged in successfully");
                    window.location.reload(); // Refresh to apply authentication
                }
            } catch (error) {
                console.error("Login failed:", error.response?.data?.message);
            }
        };
        
        const checkLogin = async () => {
            try {
                const response = await axios.get("/protected-route", { withCredentials: true });
                console.log("User is already logged in:", response.data.user);
                document.getElementById("user-email").innerText = response.data.user.email; // Show email in UI
            } catch (error) {
                console.log("User is not logged in");
            }
        };
        
        // Call this function on page load
        window.onload = checkLogin;
        


        
    </script>
</body>
</html>